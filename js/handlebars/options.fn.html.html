<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>~/workspace/code-pieces/js/handlebars/options.fn.html.html</title>
<meta name="Generator" content="Vim/7.3">
<meta name="plugin-version" content="vim7.3_v10">
<meta name="syntax" content="html">
<meta name="settings" content="number_lines,use_css,pre_wrap,expand_tabs">
<style type="text/css">
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #ffffff; background-color: #000000; }
body { font-family: monospace; color: #ffffff; background-color: #000000; }
.lnr { color: #ffff00; font-weight: bold; }
.Special { color: #ff6060; font-weight: bold; }
.Identifier { color: #00ffff; font-weight: bold; }
.Title { color: #ff40ff; font-weight: bold; }
.Type { color: #00ff00; font-weight: bold; }
.PreProc { color: #8080ff; font-weight: bold; }
.Statement { color: #ffff00; font-weight: bold; }
.Comment { color: #00ffff; font-weight: bold; }
-->
</style>
</head>
<body>
<pre>
<span class="lnr">  1 </span><span class="Comment">&lt;!DOCTYPE HTML&gt;</span>
<span class="lnr">  2 </span>&lt;<span class="Statement">html</span>&gt;
<span class="lnr">  3 </span><span class="Comment">&lt;!</span><span class="Comment">-- </span>
<span class="lnr">  4 </span><span class="Comment">I got confused when first time using options.fn for block helper with </span>
<span class="lnr">  5 </span><span class="Comment">handlebars.js, version 1.3.0.  Let's check it in example, here we also use </span>
<span class="lnr">  6 </span><span class="Comment">jquery.inspect.js to inspect elements.</span>
<span class="lnr">  7 </span>
<span class="lnr">  8 </span>
<span class="lnr">  9 </span><span class="Comment">refers to: </span>
<span class="lnr"> 10 </span>
<span class="lnr"> 11 </span><span class="Comment">  <a href="http://javascriptissexy.com/handlebars-js-tutorial-learn-everything-about-handlebars-js-javascript-templating/">http://javascriptissexy.com/handlebars-js-tutorial-learn-everything-about-handlebars-js-javascript-templating/</a></span>
<span class="lnr"> 12 </span>
<span class="lnr"> 13 </span><span class="Comment">  <a href="http://blog.teamtreehouse.com/handlebars-js-part-2-partials-and-helpers">http://blog.teamtreehouse.com/handlebars-js-part-2-partials-and-helpers</a></span>
<span class="lnr"> 14 </span>
<span class="lnr"> 15 </span><span class="Comment">  handlebarsjs.com</span>
<span class="lnr"> 16 </span>
<span class="lnr"> 17 </span><span class="Comment">  inspector: <a href="https://github.com/ssoper/jquery-inspect">https://github.com/ssoper/jquery-inspect</a></span>
<span class="lnr"> 18 </span><span class="Comment">--</span><span class="Comment">&gt;</span>
<span class="lnr"> 19 </span>&lt;<span class="Statement">head</span>&gt;
<span class="lnr"> 20 </span><span class="PreProc">  </span>&lt;<span class="Statement">meta</span> <span class="Type">charset</span>=&quot;utf-8&quot;&gt;
<span class="lnr"> 21 </span><span class="PreProc">  </span>&lt;<span class="Statement">title</span>&gt;<span class="Title">helper, block helper, options.fn in Handlebars.js</span><span class="Identifier">&lt;/</span><span class="Statement">title</span><span class="Identifier">&gt;</span>
<span class="lnr"> 22 </span><span class="PreProc">  </span><span class="Comment">&lt;!</span><span class="Comment">-- Load handlerbars.js  --</span><span class="Comment">&gt;</span>
<span class="lnr"> 23 </span><span class="PreProc">  </span><span class="Comment">&lt;!</span><span class="Comment">-- Download handlerbars.js and put it in the same folder. --</span><span class="Comment">&gt;</span>
<span class="lnr"> 24 </span><span class="PreProc">  </span>&lt;<span class="Statement">script</span> <span class="Type">src</span>=&quot;handlebars.js&quot;&gt;<span class="Identifier">&lt;/</span><span class="Statement">script</span><span class="Identifier">&gt;</span>
<span class="lnr"> 25 </span><span class="PreProc">  </span><span class="Comment">&lt;!</span><span class="Comment">-- Load Jquery from CDN  for easy DOM manipulations </span>
<span class="lnr"> 26 </span><span class="Comment">    &lt;script src=&quot;<a href="http://code.jquery.com/jquery-latest.min.js">http://code.jquery.com/jquery-latest.min.js</a>&quot;    </span>
<span class="lnr"> 27 </span><span class="Comment">    type=&quot;text/javascript&quot;&gt;&lt;/script&gt;</span>
<span class="lnr"> 28 </span><span class="Comment">  --</span><span class="Comment">&gt;</span>
<span class="lnr"> 29 </span><span class="PreProc">  </span><span class="Comment">&lt;!</span><span class="Comment">-- Here jquery.min.js already put in local folder. --</span><span class="Comment">&gt;</span>
<span class="lnr"> 30 </span><span class="PreProc">  </span>&lt;<span class="Statement">script</span> <span class="Type">src</span>=&quot;../bower_components/jquery/dist/jquery.min.js&quot;
<span class="lnr"> 31 </span>    <span class="Type">type</span>=&quot;text/javascript&quot;&gt;<span class="Identifier">&lt;/</span><span class="Statement">script</span><span class="Identifier">&gt;</span>
<span class="lnr"> 32 </span><span class="PreProc">  </span><span class="Comment">&lt;!</span><span class="Comment">-- download and put jquery.inspect.js in a local folder --</span><span class="Comment">&gt;</span>
<span class="lnr"> 33 </span><span class="PreProc">  </span>&lt;<span class="Statement">script</span> <span class="Type">src</span>=&quot;../jquery.inspect.js&quot; <span class="Type">type</span>=&quot;text/javascript&quot;&gt;<span class="Identifier">&lt;/</span><span class="Statement">script</span><span class="Identifier">&gt;</span>
<span class="lnr"> 34 </span>
<span class="lnr"> 35 </span><span class="PreProc">  </span><span class="Comment">&lt;!</span><span class="Comment">-- Handlebars template, inside {{variable}} are variables</span>
<span class="lnr"> 36 </span><span class="Comment">  --</span><span class="Comment">&gt;</span>
<span class="lnr"> 37 </span>
<span class="lnr"> 38 </span><span class="PreProc">  </span>&lt;<span class="Statement">script</span> <span class="Type">id</span>=&quot;block-template&quot; <span class="Type">type</span>=&quot;x-handlebars-template&quot;&gt;
<span class="lnr"> 39 </span><span class="Special">    </span>{{<span class="Special">#userScore </span><span class="Identifier">this</span>}}
<span class="lnr"> 40 </span><span class="Special">      &lt;div&gt;</span>{{<span class="Special">firstName</span>}}<span class="Special"> </span>{{<span class="Special">lastName</span>}}<span class="Special">, Your Total Score is </span>{{<span class="Special">score</span>}}<span class="Special"> &lt;/div&gt;</span>
<span class="lnr"> 41 </span><span class="Special">    </span>{{<span class="Special">/userScore</span>}}
<span class="lnr"> 42 </span><span class="Special">  </span><span class="Identifier">&lt;/</span><span class="Statement">script</span><span class="Identifier">&gt;</span>
<span class="lnr"> 43 </span><span class="PreProc">  </span>
<span class="lnr"> 44 </span><span class="PreProc">  </span>&lt;<span class="Statement">script</span> <span class="Type">type</span>=&quot;text/javascript&quot;&gt;
<span class="lnr"> 45 </span>
<span class="lnr"> 46 </span><span class="Special">    </span><span class="Comment">// The data used to render the template</span>
<span class="lnr"> 47 </span><span class="Special">    </span><span class="Identifier">var</span><span class="Special"> contextObj_4block = </span>[
<span class="lnr"> 48 </span><span class="Special">        </span>{<span class="Special">firstName: </span>&quot;Kapil&quot;<span class="Special">, lastName:</span>&quot;Manish&quot;<span class="Special">, score:</span>[22<span class="Special">, </span>34<span class="Special">, </span>45<span class="Special">, </span>67]}<span class="Special">, </span>
<span class="lnr"> 49 </span><span class="Special">        </span>{<span class="Special">firstName: </span>&quot;Bruce&quot;<span class="Special">, lastName:</span>&quot;Kasparov&quot;<span class="Special">, score:</span>[10<span class="Special">, </span>34<span class="Special">, </span>67<span class="Special">, </span>90]}]<span class="Special">;</span>
<span class="lnr"> 50 </span>
<span class="lnr"> 51 </span><span class="Special">    Handlebars.registerHelper </span>(&quot;userScore&quot;<span class="Special">, </span>function<span class="Special"> </span>(<span class="Special">dataObject, options</span>)<span class="Special"> </span>{
<span class="lnr"> 52 </span><span class="Special">      </span><span class="Identifier">var</span><span class="Special"> templateWithInterpolatedData = </span>&quot;&quot;<span class="Special">;</span>
<span class="lnr"> 53 </span>
<span class="lnr"> 54 </span><span class="Special">      </span><span class="Statement">for</span><span class="Special"> </span>(<span class="Identifier">var</span><span class="Special"> i = dataObject.length - </span>1<span class="Special">; i &gt;= </span>0<span class="Special">; i--</span>)<span class="Special"> </span>{
<span class="lnr"> 55 </span><span class="Special">        </span><span class="Comment">//Sum user scores from the score array and replace the array with the total</span>
<span class="lnr"> 56 </span><span class="Special">        dataObject</span>[<span class="Special">i</span>]<span class="Special">.score = dataObject</span>[<span class="Special">i</span>]<span class="Special">.score.reduce</span>(function<span class="Special"> </span>(
<span class="lnr"> 57 </span><span class="Special">          prev, cur, index, </span><span class="Type">array</span>)<span class="Special"> </span>{
<span class="lnr"> 58 </span><span class="Special">              </span><span class="Statement">return</span><span class="Special"> prev + cur;</span>
<span class="lnr"> 59 </span><span class="Special">        </span>})<span class="Special">;</span>
<span class="lnr"> 60 </span>
<span class="lnr"> 61 </span><span class="Special">        </span><span class="Comment">// Each object in the data object array is interpolated with the</span>
<span class="lnr"> 62 </span><span class="Special">        </span><span class="Comment">// options.fn method, which processes all the HTML from the template and</span>
<span class="lnr"> 63 </span><span class="Special">        </span><span class="Comment">// insert the values from the object in their respective positions.</span>
<span class="lnr"> 64 </span>
<span class="lnr"> 65 </span><span class="Special">        </span><span class="Comment">// Just so you understand the purpose of the options.fn method: it does</span>
<span class="lnr"> 66 </span><span class="Special">        </span><span class="Comment">// exactly what the regular handlebars template function does when we pass</span>
<span class="lnr"> 67 </span><span class="Special">        </span><span class="Comment">// the data object to the function, to  retrieve the values from the</span>
<span class="lnr"> 68 </span><span class="Special">        </span><span class="Comment">// object and insert them into the HTML from the template.</span>
<span class="lnr"> 69 </span>
<span class="lnr"> 70 </span><span class="Special">        </span><span class="Comment">// Without the options.fn object in this example, the raw objects</span>
<span class="lnr"> 71 </span><span class="Special">        </span><span class="Comment">// (instead of the interpolated values) would have been returned</span>
<span class="lnr"> 72 </span>
<span class="lnr"> 73 </span><span class="Special">        templateWithInterpolatedData += options.fn </span>(<span class="Special">dataObject</span>[<span class="Special">i</span>])<span class="Special">;</span>
<span class="lnr"> 74 </span><span class="Special">        </span><span class="Comment">//</span>
<span class="lnr"> 75 </span><span class="Special">        </span><span class="Comment">//$.inspect(options, 'window');</span>
<span class="lnr"> 76 </span><span class="Special">        </span><span class="Comment">//$.inspect(options.fn, 'window');</span>
<span class="lnr"> 77 </span><span class="Special">        $</span>('#inspect-details')<span class="Special">.append</span>(<span class="Special"> </span>&quot;before options.fn <span class="Special">\n</span>&quot;<span class="Special"> </span>)<span class="Special">;</span>
<span class="lnr"> 78 </span><span class="Special">        $</span>('#inspect-details')<span class="Special">.append</span>(<span class="Special"> $.inspect</span>(<span class="Special">dataObject</span>[<span class="Special">i</span>]<span class="Special">, </span>'text')<span class="Special"> </span>)<span class="Special">;</span>
<span class="lnr"> 79 </span><span class="Special">        $</span>('#inspect-details')<span class="Special">.append</span>(<span class="Special"> </span>&quot;<span class="Special">\n</span>after options.fn :<span class="Special">\n</span>&quot;<span class="Special"> </span>)<span class="Special">;</span>
<span class="lnr"> 80 </span><span class="Special">        $</span>('#inspect-details')<span class="Special">.append</span>(<span class="Special"> $.inspect</span>(<span class="Special">options.fn</span>(<span class="Special">dataObject</span>[<span class="Special">i</span>])<span class="Special">, </span>'text')<span class="Special"> </span>)<span class="Special">;</span>
<span class="lnr"> 81 </span>
<span class="lnr"> 82 </span><span class="Special">      </span>}
<span class="lnr"> 83 </span>
<span class="lnr"> 84 </span><span class="Special">      </span><span class="Comment">// We return the full string of HTML with all the values from the data</span>
<span class="lnr"> 85 </span><span class="Special">      </span><span class="Comment">// object inserted into place.</span>
<span class="lnr"> 86 </span>
<span class="lnr"> 87 </span><span class="Special">      </span><span class="Statement">return</span><span class="Special"> templateWithInterpolatedData;</span>
<span class="lnr"> 88 </span><span class="Special">    </span>})<span class="Special">;</span>
<span class="lnr"> 89 </span>
<span class="lnr"> 90 </span><span class="Special">  </span>
<span class="lnr"> 91 </span><span class="Special">    </span><span class="Comment">//wait for page to load</span>
<span class="lnr"> 92 </span><span class="Special">    $</span>(<span class="Statement">document</span>)<span class="Special">.ready</span>(function(){
<span class="lnr"> 93 </span><span class="Special">      </span><span class="Comment">// Extract the text from the template .html() is the jquery method for that</span>
<span class="lnr"> 94 </span><span class="Special">      </span><span class="Identifier">var</span><span class="Special"> block_template_text = $</span>('#block-template')<span class="Special">.html</span>()<span class="Special">;</span>
<span class="lnr"> 95 </span><span class="Special">      </span><span class="Comment">// Compile that into an handlebars template</span>
<span class="lnr"> 96 </span><span class="Special">      </span><span class="Identifier">var</span><span class="Special"> block_template = Handlebars.compile</span>(<span class="Special">block_template_text</span>)<span class="Special">;</span>
<span class="lnr"> 97 </span><span class="Special">      </span><span class="Comment">// Render the template to html</span>
<span class="lnr"> 98 </span><span class="Special">      </span><span class="Identifier">var</span><span class="Special"> block_html = block_template</span>(<span class="Special">contextObj_4block</span>)<span class="Special">;</span>
<span class="lnr"> 99 </span><span class="Special">      </span><span class="Comment">// append it to the `div`</span>
<span class="lnr">100 </span><span class="Special">      $</span>('#block-helper-template-here')<span class="Special">.append</span>(<span class="Special">block_html</span>)<span class="Special">;</span>
<span class="lnr">101 </span><span class="Special">    </span>})<span class="Special">;</span>
<span class="lnr">102 </span><span class="Special">  </span><span class="Identifier">&lt;/</span><span class="Statement">script</span><span class="Identifier">&gt;</span>
<span class="lnr">103 </span><span class="Identifier">&lt;/</span><span class="Statement">head</span><span class="Identifier">&gt;</span>
<span class="lnr">104 </span>
<span class="lnr">105 </span>&lt;<span class="Statement">body</span>&gt;
<span class="lnr">106 </span><span class="Comment">&lt;!</span><span class="Comment">-- Insertion point for handlebars template --</span><span class="Comment">&gt;</span>
<span class="lnr">107 </span>&lt;<span class="Statement">h1</span>&gt;<span class="Title"> Contents get by </span>&lt;<span class="Statement">i</span>&gt;<span class="Title">block</span><span class="Identifier">&lt;/</span><span class="Statement">i</span><span class="Identifier">&gt;</span><span class="Title"> helper: </span><span class="Identifier">&lt;/</span><span class="Statement">h1</span><span class="Identifier">&gt;</span>
<span class="lnr">108 </span>&lt;<span class="Statement">div</span> <span class="Type">id</span>=&quot;block-helper-template-here&quot; <span class="Type">style</span>=&quot;margin-left:100px&quot;&gt; <span class="Identifier">&lt;/</span><span class="Statement">div</span><span class="Identifier">&gt;</span>
<span class="lnr">109 </span>&lt;<span class="Statement">hr</span> /&gt;
<span class="lnr">110 </span>&lt;<span class="Statement">h1</span>&gt;<span class="Title"> Inspect inside: </span><span class="Identifier">&lt;/</span><span class="Statement">h1</span><span class="Identifier">&gt;</span>
<span class="lnr">111 </span>&lt;<span class="Statement">p</span>&gt;
<span class="lnr">112 </span>  &lt;<span class="Statement">pre</span> <span class="Type">id</span>=&quot;inspect-details&quot; <span class="Type">style</span>=&quot;margin-left:50px&quot;&gt; <span class="Identifier">&lt;/</span><span class="Statement">pre</span><span class="Identifier">&gt;</span>
<span class="lnr">113 </span><span class="Identifier">&lt;/</span><span class="Statement">p</span><span class="Identifier">&gt;</span>
<span class="lnr">114 </span>
<span class="lnr">115 </span><span class="Identifier">&lt;/</span><span class="Statement">body</span><span class="Identifier">&gt;</span>
<span class="lnr">116 </span><span class="Comment">&lt;!</span><span class="Comment">-- vim&#0058; set et ts=2 sw=2: --</span><span class="Comment">&gt;</span>
<span class="lnr">117 </span><span class="Identifier">&lt;/</span><span class="Statement">html</span><span class="Identifier">&gt;</span>
</pre>
</body>
</html>
